<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Test Page</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container py-5">
      <h1>Admin Functions Test</h1>

      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5>User Management Tests</h5>
            </div>
            <div class="card-body">
              <button
                class="btn btn-sm btn-success mb-2"
                onclick="testToggleUser()"
              >
                Test Toggle User Status
              </button>
              <div id="userResult" class="alert alert-info d-none"></div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5>Category Management Tests</h5>
            </div>
            <div class="card-body">
              <button
                class="btn btn-sm btn-primary mb-2"
                onclick="testCreateCategory()"
              >
                Test Create Category
              </button>
              <button
                class="btn btn-sm btn-warning mb-2"
                onclick="testDeleteCategory()"
              >
                Test Delete Category
              </button>
              <div id="categoryResult" class="alert alert-info d-none"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-warning text-dark">
              <h5>Course Approval Tests</h5>
            </div>
            <div class="card-body">
              <button
                class="btn btn-sm btn-success mb-2"
                onclick="testApproveCourse()"
              >
                Test Approve Course
              </button>
              <button
                class="btn btn-sm btn-danger mb-2"
                onclick="testRejectCourse()"
              >
                Test Reject Course
              </button>
              <div id="courseResult" class="alert alert-info d-none"></div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-info text-white">
              <h5>Navigation Tests</h5>
            </div>
            <div class="card-body">
              <a
                href="/admin/dashboard"
                class="btn btn-sm btn-primary d-block mb-2"
                >Go to Dashboard</a
              >
              <a href="/admin/users" class="btn btn-sm btn-primary d-block mb-2"
                >Go to Users</a
              >
              <a
                href="/admin/categories"
                class="btn btn-sm btn-primary d-block mb-2"
                >Go to Categories</a
              >
              <a
                href="/admin/reports/statistics"
                class="btn btn-sm btn-primary d-block mb-2"
                >Go to Statistics</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function showResult(elementId, message, isSuccess) {
        const el = document.getElementById(elementId);
        el.className = `alert ${isSuccess ? "alert-success" : "alert-danger"}`;
        el.textContent = message;
        el.classList.remove("d-none");
      }

      function testToggleUser() {
        fetch("/admin/users/3/toggle-status", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ status: 0 }),
        })
          .then((response) => response.json())
          .then((data) => {
            showResult(
              "userResult",
              JSON.stringify(data, null, 2),
              data.success
            );
          })
          .catch((error) => {
            showResult("userResult", "Error: " + error.message, false);
          });
      }

      function testCreateCategory() {
        const formData = new FormData();
        formData.append("name", "Test Category " + Date.now());
        formData.append("description", "This is a test category");

        fetch("/admin/categories/store", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            if (response.redirected) {
              showResult(
                "categoryResult",
                "Category created! Redirected to: " + response.url,
                true
              );
            } else {
              return response.text();
            }
          })
          .then((text) => {
            if (text) showResult("categoryResult", text, false);
          })
          .catch((error) => {
            showResult("categoryResult", "Error: " + error.message, false);
          });
      }

      function testDeleteCategory() {
        const categoryId = prompt("Enter category ID to delete:");
        if (!categoryId) return;

        fetch(`/admin/categories/${categoryId}/delete`, {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            showResult(
              "categoryResult",
              JSON.stringify(data, null, 2),
              data.success
            );
          })
          .catch((error) => {
            showResult("categoryResult", "Error: " + error.message, false);
          });
      }

      function testApproveCourse() {
        const courseId = prompt("Enter course ID to approve:");
        if (!courseId) return;

        fetch(`/admin/courses/${courseId}/approve`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "approve" }),
        })
          .then((response) => response.json())
          .then((data) => {
            showResult(
              "courseResult",
              JSON.stringify(data, null, 2),
              data.success
            );
          })
          .catch((error) => {
            showResult("courseResult", "Error: " + error.message, false);
          });
      }

      function testRejectCourse() {
        const courseId = prompt("Enter course ID to reject:");
        if (!courseId) return;
        const reason = prompt("Enter rejection reason (min 10 chars):");
        if (!reason || reason.length < 10) {
          showResult(
            "courseResult",
            "Reason must be at least 10 characters",
            false
          );
          return;
        }

        fetch(`/admin/courses/${courseId}/reject`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ reason: reason }),
        })
          .then((response) => response.json())
          .then((data) => {
            showResult(
              "courseResult",
              JSON.stringify(data, null, 2),
              data.success
            );
          })
          .catch((error) => {
            showResult("courseResult", "Error: " + error.message, false);
          });
      }
    </script>
  </body>
</html>
